<html><head><link href=prism.css rel=stylesheet /></head><body><style>
html {
    font-size: 100% /* or 62.5% or whatever you like, it doesn't matter, it's just a browser fix, however "rem" units will be based on that value, so make it confortable for calculations */
}
body {counter-reset:section;}
h1 {counter-reset:subsection;}
h1:before
{
counter-increment:section;
content: counter(section) ". ";
    font-weight:bold;
}
h2:before
{
counter-increment:subsection;
content:counter(section) "." counter(subsection) " ";
}

img {
    display: block;
    margin-left: auto;
    margin-right: auto;
    width: 50%;
}

@media print {
    .next_file {
        page-break-before: always;
 
    }
}
</style>
<h1>COE Toolkit Command Line Interface</h1>
<!-- toc -->
<ul>
<li><a href="#readme.md">Introduction</a>
<ul>
<li><a href="#sample-local-install.md">Sample Local Install</a></li>
<li><a href="#sample-docker-install.md">Sample Docker Install</a></li>
<li><a href="#upgrade.md">Upgrade</a></li>
</ul>
</li>
<li><a href="#aa4am_readme.md">ALM Accelerator for Advanced Makers</a>
<ul>
<li><a href="#aa4am_scenarios_readme.md">Scenarios</a>
<ul>
<li><a href="#aa4am_scenarios_tenant-deployments.md">Tenant Deployments</a></li>
<li><a href="#aa4am_scenarios_devops-deployment-model.md">DevOps Deployment Model</a></li>
</ul>
</li>
<li><a href="#aa4am_personas.md">Personas</a></li>
<li><a href="#aa4am_key-concepts.md">Key Concepts</a></li>
<li><a href="#aa4am_before-you-start.md">Before You Start</a></li>
<li><a href="#aa4am_admin-install.md">Admin Install</a></li>
<li><a href="#aa4am_development-environments.md">Development Environments</a></li>
<li><a href="#aa4am_maker-setup.md">Maker Setup</a></li>
<li><a href="#aa4am_command-reference.md">Command Reference</a></li>
</ul>
</li>
<li><a href="#cli-development_readme.md">CLI Development</a>
<ul>
<li><a href="#cli-development_documentation.md">Documentation</a></li>
<li><a href="#cli-development_adding-new-command.md">Adding New Command</a></li>
</ul>
</li>
</ul>
<p id="readme.md" class="next_file"></p>
<h1>Overview</h1>
<p>Once you have an install of the command line interface and it's <a href="#prerequisites">pre-requisites</a> you can review the following commands</p>
<ul>
<li>
<p><a href="#install.md">Install</a> - How to install the COE cli.</p>
</li>
<li>
<p><a href="#aa4am_readme.md">ALM Accelerator for Advanced Makers</a> - Use CLI commands to setup and configure an environment for Advanced Makers to enable them to do more.</p>
</li>
</ul>
<h2>Background</h2>
<p><img src="images/cli-why.png" alt="Why CLI" /></p>
<p>The COE CLI has been design to provide a set of commands that different <a href="#aa4am_personas.md">personas</a> across the organization can use to automate the process of installing COE components covering Azure, Azure DevOps and the Power Platform. </p>
<p><img src="images/cli-unified-process.png" alt="CLI Unified" /></p>
<p>The COE CLI wraps existing CLI and APIs so that there is a set of commands that can be used to holistically automate the end to end Microsoft Solution deployment required by COE services. </p>
<h2>Getting Started</h2>
<p>Once installed can use -h argument to see help options</p>
<pre><code class="language-bash">coe -h

</code></pre>
<p>Authentication for tasks is managed using the Azure CLI. Using standard az cli commands you can login, logout and select accounts. For example</p>
<pre><code class="language-bash">az login
coe aa4am install -c add
az logoff
</code></pre>
<h2>Read More</h2>
<p>Further reading</p>
<ul>
<li><a href="#upgrade.md">COE CLI Upgrade</a> How to upgrade to a new version of the COE install.<p id="sample-local-install.md" class="next_file"></p></li>
</ul>
<h2>Overview</h2>
<p>The following captures the results of a sample local install</p>
<p><img src="install-local.svg" alt="Local Install" /><p id="sample-docker-install.md" class="next_file"></p></p>
<h2>Overview</h2>
<p>The following captures the results of a sample docker install on linux</p>
<p><img src="install-docker.svg" alt="Docker Install" /><p id="upgrade.md" class="next_file"></p></p>
<h1>Overview</h1>
<p>Upgrade will depend on how you installed the COE cli</p>
<h2>Download</h2>
<p>It you downloaded the COE CLI as a zip file or a git clone</p>
<ul>
<li>Download the new zip file</li>
<li>Unzip the zip file to a new folder </li>
</ul>
<p>OR</p>
<ul>
<li>Pull changes from git</li>
</ul>
<pre><code class="language-bash">git pull

</code></pre>
<p>ONe you have a local version of the coe-cli change to coe-cli folder</p>
<pre><code>cd coe-cli

</code></pre>
<h3>Local Upgrade</h3>
<p>In the coe-cli folder run the following commands</p>
<ol>
<li>Install the dependencies</li>
</ol>
<pre><code class="language-bash">npm install

</code></pre>
<ol start="5">
<li>Build the new version</li>
</ol>
<pre><code class="language-bash">npm run build

</code></pre>
<ol start="6">
<li>Update coe to new version</li>
</ol>
<pre><code class="language-bash">npm link --force

</code></pre>
<h2>Docker Image</h2>
<p>In the coe-cli folder run the following commands</p>
<ol>
<li>Build new docker image</li>
</ol>
<pre><code class="language-bash">docker build -t coe-cli .

</code></pre>
<p id="aa4am_readme.md" class="next_file"></p>
<h1>ALM Accelerator for Advanced Makers</h1>
<p>The <a href="https://github.com/microsoft/coe-starter-kit/tree/main/ALMAcceleratorForAdvancedMakers">ALM Accelerator for Advanced Makers</a> (AA4AM) 
command allows you to manage common tasks for Advanced Makers. </p>
<p>Not sure what AA4AM is and how it can help? The main GitHub project <a href="https://github.com/microsoft/coe-starter-kit/blob/main/ALMAcceleratorForAdvancedMakers/README.md">README</a> provides further context and examples of usage.</p>
<h2>Getting Started</h2>
<ul>
<li><a href="#aa4am_scenarios_readme.md">Scenarios</a> - Discusses different install scenarios for AA4AM from Demo Installs to Enterprise Deployments</li>
<li><a href="#aa4am_personas.md">Personas</a> - Understand the key personas and how they may to AA4AML CLI commands and the wider AA4AM process.</li>
<li><a href="#aa4am_key-concepts.md">Key Concepts</a> - Understand the key concepts for the components that are being automated under the hood by the CLI commands</li>
</ul>
<h2>Overview</h2>
<p>The diagram below provides an overview of the key components required and permissions required.</p>
<p><img src="images/aa4am-overview.jpg" alt="ALM Accelerator for Advanced Makers Overview" /></p>
<h2>Sample Install</h2>
<p>The following recording shows a sample generating a install configuration file and installing AA4AM using the config file using a <a href="./scenarios/tenant-deployments.md#demonstration-deployment">Demo Deployment</a>.</p>
<p><img src="aa4am/install.svg" alt="Example" /></p>
<h2>Install Overview</h2>
<ol>
<li>
<p>Review the <a href="#aa4am_before-you-start.md">Before You Start</a> to ensure you have the required Power Platform environments and Azure DevOps organizations created</p>
</li>
<li>
<p>As an administrator complete the <a href="#aa4am_admin-install.md">Admin Install</a></p>
</li>
<li>
<p>Have Advanced Makers create <a href="#aa4am_development-environments.md">Development Environments</a></p>
</li>
<li>
<p>Use <a href="#aa4am_maker-setup.md">Maker Setup</a> to create and setup environment and solution branches in the Azure DevOps repository.</p>
</li>
</ol>
<p>Notes:</p>
<ol>
<li>If this is your first build pipeline you will need to set Pipeline Variables for your environment. At a minimum you will need to set <strong>ServiceConnection</strong> variable to your environment you have setup for validation, test and production.</li>
</ol>
<h2>Read Next</h2>
<ul>
<li><a href="#aa4am_command-reference.md">Command Reference</a></li>
<li><a href="https://github.com/microsoft/coe-starter-kit/tree/main/ALMAcceleratorForAdvancedMakers">ALM Accelerator for Advanced Makers</a> - Overview for AA4AM</li>
<li>Manual Setup - Understand the key steps that the CLI is automating
<ul>
<li><a href="https://github.com/microsoft/coe-starter-kit/blob/main/ALMAcceleratorForAdvancedMakers/SETUPGUIDE.md#foundational-setup">Foundational Setup</a> - Foundational Setup for Manual steps automated by the CLI install command</li>
<li><a href="https://github.com/microsoft/coe-starter-kit/blob/main/ALMAcceleratorForAdvancedMakers/SETUPGUIDE.md#development-project-setup">Development Project Setup</a> - Documents the Manual steps that are automated by the CLI install command</li>
<li><a href="https://github.com/microsoft/coe-starter-kit/blob/main/ALMAcceleratorForAdvancedMakers/SETUPGUIDE.md#solution-setup">Solution Setup</a> - Documents the manual steps to setup Azure DevOps that are by the CLI install command</li>
<li><a href="https://github.com/microsoft/coe-starter-kit/blob/main/ALMAcceleratorForAdvancedMakers/SETUPGUIDE.md#importing-the-solution-and-configuring-the-app">Importing Solution</a> - Documents the manual steps to import the managed solution that are by the CLI install command<p id="aa4am_scenarios_readme.md" class="next_file"></p></li>
</ul>
</li>
</ul>
<h1>Scenarios</h1>
<p>As you plan you ALM Accelerator for Advanced Makers (AA4AM) one or more of the following scenarios may apply to you.</p>
<ul>
<li>
<p><a href="#aa4am_scenarios_tenant-deployments.md">Tenant Deployments</a> - Discusses different Azure Active Directory configurations across Demo, Single AAD and Multiple AAD deployment models.</p>
</li>
<li>
<p><a href="#aa4am_scenarios_devops-deployment-model.md">DevOps Deployment Model</a> - Discuss the relationship between AA4AM deployments and one or more different Azure DevOps organizations. <p id="aa4am_scenarios_tenant-deployments.md" class="next_file"></p></p>
</li>
</ul>
<h1>Tenant Deployments</h1>
<p>AA4AM can be deployed in the following scenarios single demo tenant, single enterprise tenant.</p>
<p>Currently AA4AM <strong>does not</strong> support a multi tenant enterprise deployment model.</p>
<p><img src="images/aa4am-deployments.png" alt="Deployments Scenarios" /></p>
<h2>Factors to Consider</h2>
<ul>
<li>
<p>Does ALM for Low Code solutions introduce new concepts to parts of the business that has not been exposed to them before?</p>
</li>
<li>
<p>Would a demo environment deployment provide an environment allow the different <a href="./personas.md">personas</a> to experiment and accelerate adoption of ALM processes?</p>
</li>
<li>
<p>Who will manage and operate the ALM process?</p>
</li>
<li>
<p>How will the maker community be expanded to adopt new ALM concepts?</p>
</li>
<li>
<p>What steps can be put in place to adopt a self service model to provision environments and move between validation, test and production environments.</p>
</li>
</ul>
<h2>Demonstration Deployment</h2>
<p>In this scenario you are looking to quickly install AA4AM to demonstrate how it works and demonstrate the end to end process. For this scenario the following is expected.</p>
<ol>
<li>Using Trial tenant and environments to demonstrate the solution</li>
<li>Single Administrator that has rights to the
<ul>
<li>Azure Active Directory tenant administrator</li>
<li>Power Platform Global Administrator</li>
<li>Power Platform Organization Administrator</li>
</ul>
</li>
<li>Demo non administration Maker users that will be used to show process of creating ALM process for Power Platform solutions</li>
<li>Non production applications</li>
</ol>
<p>Once you have the <a href="./admin-install.md">Admin Install</a> completed Advanced makers can create <a href="./development-environments.md">Development environments</a> and have Administrators add them to Azure DevOps and the required Azure Active Directory Security Group. </p>
<p>This will typically use the following commands as the <strong>single administrator</strong></p>
<pre><code class="language-bash">coe aa4am generate install -o test.json
coe aa4am install -f test.json
</code></pre>
<p>Then add a demo user as a maker</p>
<pre><code class="language-bash">coe aa4am maker add -e https://alans-dev.crm.dynamics.com \
   -o https://dev.azure.com/contoso-dev \
   -p alm-sandbox \
   -u alans@crm716415.onmicrosoft.com
</code></pre>
<p>Finally makers can then <a href="./maker-setup.md">Setup Managed Solutions</a></p>
<h2>Enterprise Deployment</h2>
<p>In this scenario the aim is to install AA4AM inside an enterprise tenant and the following is expected.</p>
<ol>
<li>Likely to have different administration teams. For example
<ul>
<li>Azure Active Directory Administrators</li>
<li>Power Platform Administrators. May be Global Administrator or Environment Administrators</li>
<li>Azure DevOps Administrators</li>
</ul>
</li>
<li>Configuration files for AA4AM install can be shared among different Administration teams</li>
<li>Advanced Makers have separate development environments to work on changes</li>
<li>AA4AM Azure DevOps pipeline used to validate and promote to Test and Production environments</li>
</ol>
<h3>Azure Active Directory Administrators</h3>
<p>The tenant administration team will need to create the following</p>
<ol>
<li>Azure Active Directory Application that will be used as Service Principal in Azure DevOps and Power Power Environments</li>
<li>Azure Active Directory Group that will be used to grant access to Advanced Makers to Azure DevOps resources and Maker Canvas Application and Dataverse Tables.</li>
<li>Grant Tenant Consent for Azure Active Directory Application. This required as the Azure DevOps pipeline uses APIs where an interactive user is not involved. As a result the tenant administrator consent is required.</li>
</ol>
<p>To install the solution resources the following options can be used</p>
<h4>Azure Active Directory</h4>
<ol>
<li>Use the CLI to install the AAD components. For example using the default install parameters</li>
</ol>
<pre><code class="language-bash">coe aa4am install -c aad

</code></pre>
<ol start="2">
<li>Using a shared configuration file and setting components array value to be [ &quot;aad&quot; ]</li>
</ol>
<pre><code class="language-json">{
  &quot;log&quot;: [
    &quot;info&quot;
  ],
  &quot;components&quot;: [
    &quot;aad&quot;
  ],
  &quot;aad&quot;: &quot;ALMAcceleratorServicePrincipal&quot;,
  &quot;group&quot;: &quot;ALMAcceleratorForAdvancedMakers&quot;,
  &quot;devOpsOrganization&quot;: &quot;https://dev.azure.com/contoso-dev&quot;,
  &quot;project&quot;: &quot;alm-sandbox&quot;,
  &quot;repository&quot;: &quot;pipelines&quot;,
  &quot;settings&quot;: {
    &quot;installEnvironments&quot;: [
      &quot;validation&quot;,
      &quot;test&quot;,
      &quot;prod&quot;
    ],
    &quot;validation&quot;: &quot;https://sample-validation.crm.dyamics.com&quot;,
    &quot;test&quot;: &quot;https://sample-test.crm.dyamics.com&quot;,
    &quot;prod&quot;: &quot;https://sample-prod.crm.dyamics.com&quot;,
    &quot;createSecret&quot;: &quot;true&quot;,
    &quot;region&quot;: [
      &quot;NAM&quot;
    ]
  },
  &quot;importMethod&quot;: &quot;api&quot;,
  &quot;endpoint&quot;: &quot;prod&quot;
}
</code></pre>
<h4>Azure DevOps</h4>
<pre><code class="language-bash">coe aa4am install -c devops \
  -o https://dev.azure.com/contoso-dev \
  -p alm-sandbox
</code></pre>
<h4>Power Platform Environment</h4>
<pre><code class="language-bash">coe aa4am install -f install.json

</code></pre>
<pre><code class="language-json">{
  &quot;log&quot;: [
    &quot;info&quot;
  ],
  &quot;components&quot;: [
    &quot;environment&quot;
  ],
  &quot;aad&quot;: &quot;ALMAcceleratorServicePrincipal&quot;,
  &quot;group&quot;: &quot;ALMAcceleratorForAdvancedMakers&quot;,
  &quot;devOpsOrganization&quot;: &quot;https://dev.azure.com/contoso-dev&quot;,
  &quot;project&quot;: &quot;alm-sandbox&quot;,
  &quot;repository&quot;: &quot;pipelines&quot;,
  &quot;settings&quot;: {
    &quot;installEnvironments&quot;: [
      &quot;validation&quot;,
      &quot;test&quot;,
      &quot;prod&quot;
    ],
    &quot;validation&quot;: &quot;https://sample-validation.crm.dyamics.com&quot;,
    &quot;test&quot;: &quot;https://sample-test.crm.dyamics.com&quot;,
    &quot;prod&quot;: &quot;https://sample-prod.crm.dyamics.com&quot;,
    &quot;createSecret&quot;: &quot;true&quot;,
    &quot;region&quot;: [
      &quot;NAM&quot;
    ]
  },
  &quot;importMethod&quot;: &quot;api&quot;,
  &quot;endpoint&quot;: &quot;prod&quot;
}
</code></pre>
<ol start="3">
<li>Manual install using the <a href="https://github.com/microsoft/coe-starter-kit/blob/main/ALMAcceleratorForAdvancedMakers/SETUPGUIDE.md#create-an-app-registration-in-your-aad-environment">Create An App Registration in your AAD environment</a></li>
</ol>
<h2>Multi Tenant Deployment</h2>
<p>This deployment type is involves different Azure Active Directory deployments that separate development, test and production systems. For example the following Azure Active Directory tenants</p>
<ul>
<li>
<p>contoso.onmicrosoft.com</p>
</li>
<li>
<p>contoso-dev.onmicosoft.com</p>
</li>
</ul>
<p>Currently the AA4AM installation does not support a multi-tenant deployment</p>
<h3>Multi Tenant Deployment Assumptions</h3>
<p>The multi tenant deployment is assumed to have one or more of the following</p>
<ol>
<li>
<p>Multiple Azure Active Directory tenants</p>
</li>
<li>
<p>Power Platform Environments for Development, Validation, Test and Production may be in different tenants.</p>
</li>
<li>
<p>The Azure DevOps environment may be in the Development tenant</p>
</li>
<li>
<p>Users of the main tenant my use Azure Business to Business authentication to access the development tenant</p>
</li>
<li>
<p>External users from outside the organization maybe invited to the development tenant and not have access to the main tenant</p>
</li>
</ol>
<h3>Active Active Directory Implications</h3>
<p>To support multi tenant deployments the Azure Active Directory application will need to be configured to support multi tenant authentication.</p>
<p>Further reading</p>
<ol>
<li><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/single-and-multi-tenant-apps">Tenancy in Azure Active Directory</a></li>
</ol>
<p id="aa4am_scenarios_devops-deployment-model.md" class="next_file"></p>
<h1>DevOps Deployment Model</h1>
<p><img src="images/aa4am-devops-deployment-model.png" alt="DevOps Scenarios" /></p>
<h2>Factors to Consider</h2>
<p>As yoy play you DevOps deployment mode the following factors may help you decide the best approach:</p>
<ul>
<li>
<p>Do different teams and / or business units require separate locations to store and manage solutions?</p>
</li>
<li>
<p>Cost / benefit of the overhead of managing and maintaining managing multiple DevOps process for different Power Platform Environments?</p>
</li>
<li>
<p>Do different teams or business units have differing levels of business sensitivity or data loss prevention that will require separate handling? </p>
</li>
<li>
<p>How will common shared assets be shared and managed between multiple teams? For example shared DevOps templates or Shared components.</p>
</li>
<li>
<p>Azure Active Directory security model. Will each team manage and maintain Active Directory Applications and Service Principals or will they be shared across different Power Platform environments and Azure DevOps organizations?</p>
</li>
</ul>
<h2>Power Platform 1 to 1 DevOps</h2>
<p>In this scenario the following is assumed:</p>
<ul>
<li>
<p>Single Power Platform Advanced Maker Deployment with Shared Power Platform Environments for the Advanced Maker Canvas Application, Validation, Test and Production Environments</p>
</li>
<li>
<p>Single Shared Azure DevOps where all Advanced Makers collaborate on Solutions.</p>
</li>
</ul>
<h2>Power Platform 1 to Many DevOps</h2>
<p>In this scenario the following is assumed:</p>
<ul>
<li>
<p>Single Power Platform Advanced Maker Deployment with Shared Power Platform Environments for the Advanced Maker Canvas Application, Validation, Test and Production Environments</p>
</li>
<li>
<p>Multiple Azure DevOps for different teams or Business Units.</p>
</li>
<li>
<p>Each Azure DevOps organization can have a different set of users protected bu different Role Based Access Security Rules</p>
</li>
<li>
<p>Multiple pipelines can be defined and used at an Azure DevOps level that allow solutions to be deployed to different validation, test and production environments.</p>
</li>
</ul>
<h2>Multiple Power Platform Environments and DevOps</h2>
<p>This scenario is not a recommended deployment model as is requires the deployment and management of multiple AA4AM deployments withing the organization.</p>
<p>In this scenario the following is assumed:</p>
<ul>
<li>
<p>Multiple Power Platform Advanced Maker Deployment with Shared Power Platform Environments for the Advanced Maker Canvas Application, Validation, Test and Production Environments</p>
</li>
<li>
<p>Multiple Azure DevOps for different teams or Business UNits.</p>
</li>
<li>
<p>Each Azure DevOps organization can have a different set of users protected bu different Role Based Access Security Rules<p id="aa4am_personas.md" class="next_file"></p></p>
</li>
</ul>
<h1>Overview</h1>
<p>Understanding the roles that different personas play in ALM Accelerator for Advanced Makers is important in helping you plan for and implement a AA4AM deployment in your organization.</p>
<h2>Persona Command Mapping</h2>
<p><img src="images/aa4am-command-summary.png" alt="Common Commands" /></p>
<h3>Solution Setup</h3>
<p>The first command to run will will be the <strong>coe aa4am user add</strong> command that will register an Application User as System administrator in their development environment to integrate with the solution.</p>
<pre><code class="language-bash">coe aa4am user add -e https://mydevorg.crm.dynamics.com

</code></pre>
<p>The <strong>coe aa4am branch</strong> command will be run each time a new solution is created. This command allows a new solution branch to be created in Azure DevOps with the associated ALM DevOps pipeline to validate pull requests and push changes to test and production environments.</p>
<pre><code class="language-bash">coe aa4am branch -o https://dev.azure.com/contoso -p alm-sandbox -d MySolution

</code></pre>
<h3>Administrator Setup</h3>
<p>As each Advanced Maker or Professional Developer creates a development environment it will need to be registered with Azure DevOps and the Azure Active Directory Application. THe user running this command requires Project Administrator rights in Azure DevOps and Owner rights of the Azure Active Directory Application.</p>
<pre><code class="language-bash">coe aa4am maker add -o https://dev.azure.com/contso -p alm-sandbox \
   -e https://contoso-userdev.crm.dynamics.com -a aa4am-ado-service-principal \
   -g aa4am-makers -u user@contoso.com
</code></pre>
<p>Each Azure DevOps project will also require connections to deployment environments used by Azure DevOps pipelines</p>
<pre><code class="language-bash">coe aa4am connection add -o https://dev.azure.com/contso -p alm-sandbox \
  -e https://contoso-build.crm.dynamics.com -a aa4am-ado-service-principal

coe aa4am connection add -o https://dev.azure.com/contso -p alm-sandbox \
  -e https://contoso-test.crm.dynamics.com -a aa4am-ado-service-principal

coe aa4am connection add -o https://dev.azure.com/contso -p alm-sandbox \
  -e https://contoso-prod.crm.dynamics.com -a aa4am-ado-service-principal
</code></pre>
<h3>Install</h3>
<p>To deploy an instance of AA4AM in your organization the <strong>coe aa4am generate install</strong> and <strong>coe aa4am install</strong> commands are used once to deploy the Managed solution. The install will automate key elements </p>
<ul>
<li>Azure Active Directory
<ul>
<li>New Azure Active directory Application that will be used by Azure DevOps for Service Connections and Access to Power Platform Environment</li>
<li>New Azure Active Directory Group to provide access to Azure DevOps resources and Share the Maker Canvas application</li>
</ul>
</li>
<li>Azure DevOps resources
<ul>
<li>Import Azure DevOps Pipelines</li>
<li>Variable Groups</li>
<li>Create Service Connections to Power Platform Environments</li>
</ul>
</li>
<li>Power Platform Environments
<ul>
<li>Setup Application Users</li>
<li>Import Managed Solution and Setup Security</li>
</ul>
</li>
</ul>
<pre><code class="language-bash">coe aa4am generate install -o install.json
coe aa4am install -f install.json
</code></pre>
<h2>Persona Description</h2>
<ul>
<li>
<p><strong>Business Users</strong> - Licensed internal users of the created solutions. Will not directly use the AA4AM tools they will be able to see the shared applications. May report version number of application to the support team.</p>
</li>
<li>
<p><strong>Maker</strong> - Wants to use components or services produced by an advanced maker or professional developer. Uses off the shelf components and documentation. Not directly exposed to the Application Lifecycle as this process is abstracted away. Create and Share the Application with Business Users.</p>
</li>
<li>
<p><strong>Advanced Maker</strong> - Collaborates with Professional Development and IT teams to integrate and build applications. Assumed to be familiar with concepts like ALM, DevOps, Branching and Merging. Work in Development environment and push changes into validation and testing and production environments. Works with managed Canvas management application and Azure DevOps website. Common commands</p>
</li>
<li>
<p><strong>Professional Developer</strong> - Advanced maker knowledge plus the ability to use lower level development programing languages and SDKs to create components and services. For example JavaScript and PCF controls, Dataverse Plugins in C#, Azure Services and APIs e.g. Azure functions, API Management. LIkely to work in tools like Visual Studio Code. Common commands</p>
</li>
<li>
<p><strong>Data Analyst</strong> - Develop data model, Create and manage data services and post data collection analysis / reporting. For example Power BI reporting, Datalake. For data elements that are covered in the SOlution system e.g. Dataverse Modeling, AI Models. Items not covered today in solution system today like Power BI will have separate ALM process. Common commands</p>
</li>
<li>
<p><strong>Operations Teams</strong> - Deploy solution to environments across Power Platform and Microsoft Cloud Services (e.g. Azure). Distribute solutions into Power Platform and run ARM templates in Azure. Will not use the CLI commands directly. May use managed canvas application to view and Azure DevOps pipelines to view the status or and promote applications from test to production.</p>
</li>
<li>
<p><strong>Support Teams</strong> - Post application deployment look at version of applications deployed, triage issues. May use managed canvas application to view deployed solution versions.</p>
</li>
<li>
<p><strong>Information Security Team</strong> - Will compare against organization standards for Data Loss Prevention (DLP), Authentication and Authorization, Service Principals, Teams and Security. Review the ALM process against Threat models, risks and mitigations.</p>
</li>
<li>
<p><strong>Architecture Team</strong> - Review the entire ALM process and components and verify matches solution methodology and architecture</p>
</li>
<li>
<p><strong>Administrators</strong></p>
<ul>
<li><strong>Power Platform Tenant Administrator</strong> - Global right to Power Platform Administration - Manage Environments (Create, Update, Delete). Common commands</li>
</ul>
<pre><code class="language-bash">coe aa4am generate install -o data.json
coe aa4am install -f data.json
</code></pre>
<ul>
<li><strong>Power Platform Environment Administrator</strong> - Manage One ore more Power Platform Environments - Import solution, add users assign roles</li>
</ul>
<pre><code class="language-bash">coe aa4am generate install -o data.json
coe aa4am install -c environment -e https://contoso-maker.crm.dynamics.com
</code></pre>
<p>Add makers to an environment (Assuming they also have Azure DevOps Administrator rights)</p>
<pre><code class="language-bash">coe aa4am maker add -e https://user-Dev.crm.dynamics.com \
   -o https://dev.azure.com/dev12345 \
   -p alm-sandbox \
   -u user@contoso.com
</code></pre>
<p><strong>Azure Tenant Administrator</strong> Manage the AAD Tenant - Create User, Groups,  Applications and Service Principals (O365 or Azure Administrators). Common commands</p>
<pre><code class="language-bash">coe aa4am install -c aad

</code></pre>
<p><strong>Azure DevOps Organization Administrators</strong></p>
<p><strong>Azure DevOps Project Administrators</strong></p>
<pre><code class="language-bash">coe aa4am install -c devops -o https://dev.azure.com/dev12345 -p alm-sandbox

</code></pre>
<p id="aa4am_key-concepts.md" class="next_file"></p>
</li>
</ul>
<h1>Overview</h1>
<p>As you deploy and use the AA4AM CLI it is important to understand the following key concepts that the CLI is automating.</p>
<h2>Azure Active Directory</h2>
<h3>Azure Active Directory Application</h3>
<p>The CLI application can create a Azure Active Directory application that automate the following key steps.</p>
<ol>
<li>
<p>User authenticated via Azure CLI</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/reference-index?view=azure-cli-latest#az_login">Azure Login</a></li>
<li><a href="../../src/commands/login.ts">Source Reference - login Method</a></li>
</ul>
</li>
<li>
<p>Create Azure Active Directory Application using Azure CLI</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest#az_ad_app_create">Create AD Application</a></li>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest#az_ad_sp_create">Create Service Principal</a></li>
<li><a href="../../src/commands/aad.ts">Source Reference - installAADApplication</a></li>
</ul>
</li>
<li>
<p>Grant Tenant Consent for Applications using Azure CLI</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/ad/app/permission?view=azure-cli-latest#az_ad_app_permission_admin_consent">Permissions Admin Consent</a></li>
</ul>
</li>
<li>
<p>Azure Application Granted rights via <a href="../../config/manifest.json">manifest config</a> to call</p>
<ul>
<li>Azure DevOps</li>
<li>Dataverse</li>
<li>PowerApps Checker Module - <a href="https://docs.microsoft.com/en-us/powershell/powerapps/get-started-powerapps-checker?view=pa-ps-latest">Read More</a></li>
</ul>
</li>
<li>
<p>Client secrets will be created for Azure DevOps Service Connections</p>
<ul>
<li>
<p>Client secrets should have an established key rotation process to generate new keys for connections</p>
</li>
<li>
<p>After new keys are generated old keys should be removed</p>
</li>
</ul>
</li>
</ol>
<h3>Azure Active Directory Group</h3>
<p>The CLI application can create a Azure Active Directory group that is used for Azure DevOps and Power Platform authentication and role based access security.</p>
<ol>
<li>Group Created via Azure CLI
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/cli/azure/ad/group?view=azure-cli-latest#az_ad_group_create">Create Group</a></p>
</li>
<li>
<p><a href="../../src/commands/aad.ts">Source Reference - installAADGroup</a></p>
</li>
</ul>
</li>
</ol>
<h2>Azure DevOps</h2>
<h3>Install Automation</h3>
<p>The CLI application assumes that an Azure DevOps organization and project have already been created. it performs the following key steps</p>
<ol>
<li>
<p>Source reference <a href="../../src/commands/devops.ts">devops.ts - DevOpsCommand</a></p>
</li>
<li>
<p>Install Azure DevOps Extensions defined in <a href="../../config/AzureDevOpsExtensionsDetails.json">AzureDevOpsExtensionsDetails.json</a> (Source reference - installExtensions)</p>
</li>
<li>
<p>Clone Azure Templates https://github.com/microsoft/coe-alm-accelerator-templates.git into a Azure DevOps git repository named <strong>pipelines</strong> by default  (Source reference - importPipelineRepository).</p>
</li>
<li>
<p>Create Azure DevOps build pipelines (Source reference - createAdvancedMakersBuildPipelines)</p>
</li>
</ol>
<ul>
<li>
<p><a href="https://github.com/microsoft/coe-alm-accelerator-templates/blob/main/Pipelines/export-solution-to-git.yml">export-solution-to-git.yml</a> - Export a solution from a Dataverse environment and commit it to a git branch.</p>
</li>
<li>
<p><a href="https://github.com/microsoft/coe-alm-accelerator-templates/blob/main/Pipelines/import-unmanaged-to-dev-environment.yml">import-unmanaged-to-dev-environment.yml</a> - Import solution into Dataverse environment</p>
</li>
<li>
<p><a href="https://github.com/microsoft/coe-alm-accelerator-templates/blob/main/Pipelines/delete-unmanaged-solution-and-components.yml">delete-unmanaged-solution-and-components.yml</a> - Delete or &quot;clean up&quot; an unmanaged solution from a Dataverse environment</p>
</li>
</ul>
<ol start="4">
<li>
<p>Setup Azure Active Group access the Azure DevOps project (Source reference - setupSecurity)</p>
</li>
<li>
<p>Create Variable Groups for shared variables used by build pipelines (Source reference - createAdvancedMakersBuildVariables)</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/library/variable-groups?view=azure-devops&amp;tabs=yaml">Read More</a></li>
</ul>
</li>
<li>
<p>Create Service connections to Power Platform Environments Source reference - createAdvancedMakersServiceConnections) using the Azure Active Directory Service Principal</p>
<ul>
<li>
<p>NOTE: Each service connection will receive a separate Azure Active Directory secret.</p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/library/service-endpoints?view=azure-devops&amp;tabs=yaml">Read More - Service Connections</a></p>
</li>
</ul>
</li>
</ol>
<h3>Branch Automation</h3>
<p>The <a href="./maker-setup.md#create-solution-branch">coe aa4am branch</a> command performs the following steps</p>
<ol>
<li>
<p>Create a new branch to store the Solution (Source code reference branch function)</p>
</li>
<li>
<p>Create build pipelines for the Solution Branch (Validation, Test, Production)</p>
</li>
<li>
<p>Create <a href="https://docs.microsoft.com/en-us/azure/devops/repos/git/branch-policies-overview?view=azure-devops">Branch Policies</a> to ensure validation build completes successfully</p>
</li>
</ol>
<h3>Other Concepts</h3>
<p>In addition to install automation the following concepts are also assumed for Advanced Makers</p>
<ol>
<li>A git branching strategy https://docs.microsoft.com/en-us/azure/devops/repos/git/git-branching-guidance?view=azure-devops</li>
</ol>
<ul>
<li>
<p>The AA4AM assumes a branch per solution</p>
</li>
<li>
<p>Changes merged back into main branch can be promoetd to production evironment</p>
</li>
</ul>
<ol>
<li>Manage Pull Requests to merge changes into Solution Branches https://docs.microsoft.com/en-us/azure/devops/repos/git/pull-requests?view=azure-devops</li>
</ol>
<h2>Power Platform</h2>
<h3>Automation</h3>
<p>The CLI provides the following key steps. (Source code file <a href="../../src/commands/powerplatform.ts">powerplatform.ts</a>)</p>
<ol>
<li>
<p>Import Managed solution into environment to allow Advanced Makers to Manage git import, create branches, pull requests and updates to test and production.</p>
</li>
<li>
<p>Fix Custom Connectors used to connect to Azure DevOps</p>
</li>
<li>
<p>Connect Flow to Dataverse</p>
</li>
<li>
<p>Add the user to the Azure Active Directory Service Principal to the power platform environments</p>
</li>
<li>
<p>Share the Canvas application with the Maker Azure Active Directory Group</p>
</li>
</ol>
<h3>Environments</h3>
<p>The AA4AM CLI commands currently assume the following environments have been created https://aka.ms/ppac as a Global Administrator or Environment Administrator</p>
<ol>
<li>
<p>Maker Environment</p>
<ul>
<li>
<p>Require Dataverse to be enabled</p>
</li>
<li>
<p>Created &quot;Microsoft Dataverse (legacy)&quot; connection - <a href="./before-you-start.md#maker-environment-common-data-service">Read More</a></p>
</li>
</ul>
</li>
<li>
<p>Validation, Test, Production Environments</p>
<ul>
<li>CLI can setup Azure Active Directory application as Application User with System Administrator rights</li>
</ul>
</li>
<li>
<p>Developer Environments</p>
<ul>
<li>CLI can setup Azure Active Directory application as Application User with System Administrator rights<p id="aa4am_before-you-start.md" class="next_file"></p></li>
</ul>
</li>
</ol>
<h1>Overview</h1>
<p>Before you start an install of AA4AM ensure that you have the following in place</p>
<h2>COE Command Line</h2>
<p>Install the COE CLI <a href="../install.md#local-install">locally</a> or via a <a href="../install.md#docker-install">docker image</a></p>
<h2>Power Platform</h2>
<table><thead><tr><th>Environment</th><th>Description</th></tr></thead><tbody>
<tr><td>ALM Environment</td><td>Environment with Dataverse enabled. Will be used to deploy managed solution.</td></tr>
<tr><td>ALM Environment - Dataverse Connection</td><td>See <a href="#maker-environment-dataverse">Maker Environment Dataverse</a> below to create the Dataverse Connection</td></tr>
<tr><td>Validation</td><td>Environment used to validate builds before merging into a solution branch</td></tr>
<tr><td>Test</td><td>Pre production Environment used to test solutions before moving to production</td></tr>
<tr><td>Production</td><td>Production Environment for managed solutions</td></tr>
</tbody></table>
<p>Notes:</p>
<ol>
<li>
<p>As a Microsoft Partner you can request access to demo tenants to test ALM Accelerators for Advanced Makers</p>
<ol>
<li>Visit https://docs.microsoft.com/en-us/partner-center/mpn-demos for more information</li>
<li>Go to https://demos.microsoft.com to request a new enviroment</li>
<li>Select My Environments</li>
<li>Select Create Tenant</li>
<li>Select tennat location</li>
<li>Select &quot;Dynamics 365 Customer Engagement&quot;</li>
</ol>
</li>
<li>
<p>Sample environment from https://admin.powerplatform.microsoft.com/environments for a <a href="./scenarios/tenant-deployments.md#demonstration-deployment">Demo Deployment</a></p>
<p><img src="images/environments.jpg" alt="Environments" /></p>
</li>
</ol>
<h2>Maker Environment Dataverse</h2>
<p>In the maker environment you will a Dataverse connection to be created by install user.</p>
<p>This can be done using the following steps</p>
<ol>
<li>
<p>Goto https://make.powerapps.com/</p>
</li>
<li>
<p>Select your maker environment that you will deploy the ALM Accelerator for Advanced Makers into</p>
</li>
<li>
<p>Navigate to Data -&gt; Connections</p>
</li>
<li>
<p>New Connection</p>
</li>
<li>
<p>Microsoft Dataverse (legacy)</p>
</li>
<li>
<p>Select Create</p>
</li>
</ol>
<h2>Azure</h2>
<p>Ensure the user you run with has the the following permissions</p>
<table><thead><tr><th>Component</th><th>Description</th></tr></thead><tbody>
<tr><td>Global Administrator or Privileged Role Administrator</td><td>Grant tenant-wide admin consent to an application <a href="https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/grant-admin-consent">Read More</a></td></tr>
</tbody></table>
<h2>Azure DevOps</h2>
<table><thead><tr><th>Component</th><th>Description</th></tr></thead><tbody>
<tr><td>Organization</td><td>Review <a href="https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/add-organization-users?view=azure-devops">Add Organization Users</a> to create Azure DevOps organization and add users</td></tr>
<tr><td>Project</td><td>An Azure DevOps project to integtrate with. This guide uses the name <strong>alm-sandbox</strong> as the project name</td></tr>
<tr><td>Extensions</td><td>Review the <a href="./config/AzureDevOpsExtensionsDetails.json">extensions configuration</a> that will be installed</td></tr>
<tr><td>Repository</td><td>Ensure the git repository has been initialized with an initial commit</td></tr>
</tbody></table>
<p>Notes:</p>
<ol>
<li>
<p>If installing using demo tenant you can request a trial Azure DevOps environment</p>
<ul>
<li>
<p>https://azure.microsoft.com/en-us/services/devops/</p>
</li>
<li>
<p>Create Organization</p>
</li>
<li>
<p>Create initial project e.g. alm-sandbox</p>
</li>
</ul>
</li>
<li>
<p>Review the Azure <a href="../../config/AzureDevOpsExtensionsDetails.json">DevOps Extensions</a> that will be installed by the CLI application to ensure your organization gives consent for them to be installed. </p>
<ul>
<li>
<p><a href="https://marketplace.visualstudio.com/items?itemName=microsoft-IsvExpTools.PowerPlatform-BuildTools">Power Platform Build Tools</a></p>
</li>
<li>
<p><a href="https://marketplace.visualstudio.com/items?itemName=WaelHamze.xrm-ci-framework-build-tasks">Power DevOps Tools</a></p>
</li>
<li>
<p><a href="https://marketplace.visualstudio.com/items?itemName=qetza.replacetokens">Replace Tokens</a></p>
</li>
<li>
<p><a href="https://marketplace.visualstudio.com/items?itemName=sariftools.scans">SARIF SAST Scans Tab</a></p>
</li>
</ul>
</li>
</ol>
<h2>Read Next</h2>
<p>Once you have verified the above</p>
<ol>
<li>Determine the install <a href="#aa4am_scenarios_readme.md">deployment scenario</a> you are targeting</li>
<li>Complete the <a href="#aa4am_admin-install.md">Admin Install</a></li>
</ol>
<p id="aa4am_admin-install.md" class="next_file"></p>
<h1>Overview</h1>
<p>To complete the initial steps of an AA4AM deployment you will need to complete the administrative tasks. Once this is done Advances Makers can create and register development environments.</p>
<p><img src="images/aa4am-install-overview.png" alt="ALM Accelerator for Advanced Makers Install Overview" /></p>
<p>Assuming a single user that has Power Platform Global Administrator, DevOps Administrator rights and Azure Active directory Administrator rights the install process has the following main sections below.</p>
<h2>Before You Start</h2>
<p>Complete <a href="#aa4am_before-you-start.md">Before You Start</a> to ensure that:</p>
<p>A) Power Platform Environments have been created</p>
<p>B) Azure DevOps Organization and Project has been created</p>
<p>C) COE CLI installed</p>
<h2>Initial Install</h2>
<ol>
<li>Create install configuration file and review the generated JSON file and confirm the settings before you start the install</li>
</ol>
<pre><code class="language-bash">coe aa4am generate install -o test.json

</code></pre>
<p>Which will generate a file similar to</p>
<pre><code class="language-json">{
  &quot;log&quot;: [
    &quot;info&quot;
  ],
  &quot;components&quot;: [
    &quot;all&quot;
  ],
  &quot;aad&quot;: &quot;ALMAcceleratorServicePrincipal&quot;,
  &quot;group&quot;: &quot;ALMAcceleratorForAdvancedMakers&quot;,
  &quot;devOpsOrganization&quot;: &quot;https://dev.azure.com/dev1234&quot;,
  &quot;project&quot;: &quot;alm-sandbox&quot;,
  &quot;repository&quot;: &quot;pipelines&quot;,
  &quot;settings&quot;: {
    &quot;installEnvironments&quot;: [
      &quot;validation&quot;,
      &quot;test&quot;,
      &quot;prod&quot;
    ],
    &quot;validation&quot;: &quot;https://sample-validation.crm.dyamics.com&quot;,
    &quot;test&quot;: &quot;https://sample-test.crm.dyamics.com&quot;,
    &quot;prod&quot;: &quot;https://sample-prod.crm.dyamics.com&quot;,
    &quot;createSecret&quot;: &quot;true&quot;,
    &quot;region&quot;: [
      &quot;NAM&quot;
    ]
  },
  &quot;importMethod&quot;: &quot;api&quot;,
  &quot;endpoint&quot;: &quot;prod&quot;
}
</code></pre>
<ol start="2">
<li>Review the json and being the install using the following command</li>
</ol>
<pre><code class="language-bash">coe aa4am install -f test.json

</code></pre>
<h2>Read Next</h2>
<ul>
<li>Complete the <a href="./readme.md#install-overview">Install Overview</a></li>
</ul>
<p id="aa4am_development-environments.md" class="next_file"></p>
<h1>Development Environments</h1>
<p>Each advanced maker will need a development environment created. Advanced makers can use a community environment to work in. Community environments can be accessed from the sign-up page https://web.powerapps.com/community/signup</p>
<h2>Admin Maker Setup</h2>
<p>As Azure DevOps Administrator you will need to register each advanced maker environment. The following command will add the required service connection to development environment and setup security for the user</p>
<pre><code class="language-bash">coe aa4am maker add -o https://dev.azure.com/dev12345 \
  -p alm-sandbox \
  -e https://org12345-dev.crm.dynamics.com \
  -u username@contoso.com
</code></pre>
<h2>Read Next</h2>
<ul>
<li>Complete the <a href="./readme.md#install-overview">Install Overview</a></li>
</ul>
<p id="aa4am_maker-setup.md" class="next_file"></p>
<h1>Maker Setup</h1>
<p>Once a user has been setup with a development environment <a href="#aa4am_development-environments.md">Read More</a> they will need to use the following sections to provide access to the service principal and create a solution branch.</p>
<h2>Setup Service Principal</h2>
<p>The Azure DevOps Pipeline uses a Azure Active Directory service principal to connect to the development environment and import and export the solution. To enable access to the environment the following command will add the service principal as a System Administrator to the developer Power Platform environment.</p>
<ol>
<li>Log out of any existing sessions if not the maker or a Power Platform tenant Administrator</li>
</ol>
<pre><code class="language-bash">az logout

</code></pre>
<ol start="2">
<li>To ensure the Application User has access to the development environment you need to run the following command</li>
</ol>
<pre><code class="language-bash">coe aa4am user add -e https://org12345-dev.crm.dynamics.com

</code></pre>
<h2>Maker Create Solution</h2>
<p>Once the environment has been setup and your development environment created and registered as a service connection in Azure DevOps you can use the following steps to create a source control managed solution.</p>
<ol>
<li>
<p>Switch to Developer Environment</p>
</li>
<li>
<p>Create new solution e.g. NewSolution1</p>
</li>
<li>
<p>Add items to the solution. For example
a. Select Solution
b. Add Canvas Application
c. Add Button
d. Save Application and Close</p>
</li>
<li>
<p>Create Solution branch using the following CLI command</p>
</li>
</ol>
<pre><code class="language-bash">coe aa4am branch -o https://dev.azure.com/dev12345 -p alm-sandbox -d MySolution1

</code></pre>
<p>NOTES:</p>
<ul>
<li>
<p>-o is the name of your DevOps Organization</p>
</li>
<li>
<p>-p is the name of the Azure DevOps Project</p>
</li>
<li>
<p>-d os the name of the solution branch to create</p>
</li>
<li>
<p>If the repository you want to create a branch for is empty you will need to commit an initial commit before a branch can be created.</p>
</li>
</ul>
<ol start="5">
<li>
<p>Open ALM Accelerator for Advanced Maker Application</p>
</li>
<li>
<p>Select Push change to Git
a. Create New Branch e.g. MySolution1-WIP
b. From existing Solution Branch created above e.g. MySolution1
c. Add a comment e.g. Initial version</p>
</li>
<li>
<p>Click on Latest Push Status 
a. Permit permissions for pipeline to run (Variable Group, Service Connection, Pipeline)</p>
</li>
</ol>
<h2>Post Setup Checks</h2>
<p>After setting up an advanced maker you may need to verify the following</p>
<ol>
<li>
<p>If this is your first branch created you will need to check variables applied for the the created pipeline</p>
</li>
<li>
<p>The first time that each pipeline is run frm the administration application you will need to open the pipeline in Azure DevOps and approve the resources used by the pipeline.</p>
</li>
<li>
<p>Select the blue icon for the Azure DevOps Build in the application</p>
<p><img src="images/latest-push-status.jpg" alt="Latest Push Status" /></p>
</li>
<li>
<p>Check if is message similar to the following that requires approval of the pipeline to run</p>
<p><img src="images/devops-pipeline-permissions.jpg" alt="Azure DevOps Permissions" /></p>
</li>
<li>
<p>If required select &quot;View&quot; and permit the build pipeline to</p>
<p><img src="images/devops-pipeline-permit.jpg" alt="Azure DevOps Permit" /></p>
</li>
</ol>
<p>NOTES:</p>
<ol>
<li>If you are using a free Azure Subscription you may receive error &quot;No hosted parallelism has been purchased or granted.&quot;. To resolve this issue visit to request Azure Pipeline build compute https://aka.ms/azpipelines-parallelism-request</li>
</ol>
<h2>Read Next</h2>
<ul>
<li>Complete the <a href="./readme.md#install-overview">Install Overview</a><p id="aa4am_command-reference.md" class="next_file"></p></li>
</ul>
<h2>Command Reference</h2>
<h3>Install</h3>
<p>You can install all pre-requites if you are installing to a Dmo tenant or you have rights to Azure Active Directory, Azure DevOps and Power Platform System Administrator rights.</p>
<h4>Preparing for an Install</h4>
<p>You can start by generating a configuration file for you install using the following command</p>
<pre><code class="language-bash">coe aa4am generate install -o test.json

</code></pre>
<p>This will ask you a series of questions for the values which you can then edit and review before starting install</p>
<pre><code class="language-json">{
  &quot;log&quot;: [
    &quot;info&quot;
  ],
  &quot;components&quot;: [
    &quot;all&quot;
  ],
  &quot;aad&quot;: &quot;ALMAcceleratorServicePrincipal&quot;,
  &quot;group&quot;: &quot;ALMAcceleratorForAdvancedMakers&quot;,
  &quot;devOpsOrganization&quot;: &quot;https://dev.azure.com/dev1234&quot;,
  &quot;project&quot;: &quot;alm-sandbox&quot;,
  &quot;repository&quot;: &quot;pipelines&quot;,
  &quot;settings&quot;: {
    &quot;installEnvironments&quot;: [
      &quot;validation&quot;,
      &quot;test&quot;,
      &quot;prod&quot;
    ],
    &quot;validation&quot;: &quot;https://sample-validation.crm.dyamics.com&quot;,
    &quot;test&quot;: &quot;https://sample-test.crm.dyamics.com&quot;,
    &quot;prod&quot;: &quot;https://sample-prod.crm.dyamics.com&quot;,
    &quot;createSecret&quot;: &quot;true&quot;,
    &quot;region&quot;: [
      &quot;NAM&quot;
    ]
  },
  &quot;importMethod&quot;: &quot;api&quot;,
  &quot;endpoint&quot;: &quot;prod&quot;
}
</code></pre>
<p>To start an install with you configured settings you can use thw following.</p>
<pre><code class="language-bash">coe aa4am install -f test.json

</code></pre>
<h4>Install All Pre-requisites</h4>
<p>Install aad, DevOps and environment components using the default parameters</p>
<pre><code class="language-bash">coe aa4am install -e https://contoso-maker.crm.microsoft.com \
  -o https://dev.azure.com/dev12345 \
  -p alm-sandbox
</code></pre>
<p>Will install Managed application the AAD application and Azure DevOps components</p>
<h4>Install Azure Active Directory</h4>
<p>To install just the Azure Active Directory components using the default parameters</p>
<pre><code class="language-bash">coe aa4am install -c aad

</code></pre>
<p>Will login using the Azure CLI user and attempt to install the Azure Active Directory application required for Azure DevOps and the Application User that wil be used to interact Power Platform environments.</p>
<h4>Install DevOps</h4>
<p>To install just the DevOps components you can run the following command. This step assumes the Azure Active Directory Service Principal has been created</p>
<pre><code class="language-bash">coe aa4am install -c devops -o https://dev.azure.com/dev12345 -p alm-sandbox

</code></pre>
<p>Steps by performed by the command:</p>
<ol>
<li>Install Azure DevOps extensions. Extensions that will be installed configured in <a href="../../config/AzureDevOpsExtensionsDetails.json">config/AzureDevOpsExtensionsDetails.json</a></li>
<li>Import Azure DevOps Pipelines. Notes:</li>
</ol>
<ul>
<li>The first time the build is run permissions will need to be granted to the service connections.</li>
</ul>
<ol>
<li>Install Azure DevOps Build Pipeline for </li>
</ol>
<ul>
<li>Exporting solution to git</li>
<li>Import Unmanaged solution to Development Environment</li>
<li>Delete Development Solution</li>
</ul>
<ol>
<li>Setup Build Variables</li>
<li>Setup service connections</li>
</ol>
<h4>Install Environment</h4>
<p>Install the Managed Solution to administer the application. This step assumes that Azure Active Directory and Azure DevOps components have been created.</p>
<pre><code class="language-bash">coe aa4am install -c environment -e https://org12345-dev.crm.microsoft.com

</code></pre>
<p>Steps by performed by the command:</p>
<ol>
<li>Import the latest managed solution from GitHub into the environment</li>
</ol>
<h3>Add Maker</h3>
<p>For each developer environments you create you will need to create a service connection from Azure DevOps to the environment</p>
<pre><code class="language-bash">coe aa4am maker add -o https://dev.azure.com/dev12345 \
  -p alm-sandbox \
  -e https://org12345-dev.crm.microsoft.com \
  -u name@contoso.com
</code></pre>
<p>Notes:</p>
<ol>
<li>The command will look to add a new secret per connection to the AAD Application</li>
<li>The user will be added to the AAD</li>
</ol>
<h3>Add Environment Application User</h3>
<p>Each environment that the solution imports and exports from needs the Azure Active Directory application added as an Application user</p>
<pre><code class="language-bash">coe aa4am user add -e https://org12345-dev.crm.microsoft.com \
  -a ALMAcceleratorServicePrincipal
</code></pre>
<p>Notes:</p>
<ol>
<li>Add the name of the AAD Application as the -a argument</li>
<li>The user will be assigned to the System Administrator role of the environment</li>
</ol>
<h3>Create Branch</h3>
<p>One setup you can create a solution branch and the associated Azure DevOps Pipelines</p>
<pre><code class="language-bash">coe aa4am branch -o https://dev.azure.com/dev12345 \
  -p alm-sandbox \
  -d MyTestSolution
</code></pre>
<p>-o is the devops organization name
-p is the Azure DevOps project
-d is the destination branch to create as import the build pipelines</p>
<p>More help is available from</p>
<pre><code class="language-bash">coe aa4am branch --help

</code></pre>
<p id="cli-development_readme.md" class="next_file"></p>
<h1>Overview</h1>
<p>This document outlines the following key sections on the COE CLI. The information below can help guide you in making contributions back to the open source repository.</p>
<ul>
<li>
<p><a href="#quick-start">Quick Start</a> - Provides set of links of the technology used to build and test the CLI</p>
</li>
<li>
<p><a href="#contributions">Contributions</a> - Links to wider contributor guidance</p>
</li>
<li>
<p><a href="#development-environment-setup">Development Environment Setup</a> - How to edit the CLI using Visual Studio Code</p>
</li>
<li>
<p><a href="#cli-development_adding-new-command.md">Adding A New Command</a> - How to add a new CLI command</p>
</li>
<li>
<p><a href="#cli-development_documentation.md">Documentation</a> - Adding documentation for commands</p>
</li>
</ul>
<h2>Quick Start</h2>
<p>The coe-cli command line application makes use of following components</p>
<ol>
<li>NodeJs to provide cross platform support</li>
<li>TypeScript to leverage published type definitions for dependent components</li>
<li>Jest for unit tests. </li>
</ol>
<p>If you are new to TypeScript the following links may help</p>
<ul>
<li><a href="https://www.typescriptlang.org/docs/">Typescript docs</a></li>
<li><a href="https://docs.microsoft.com/en-us/learn/modules/typescript-get-started/">Getting Started with TypeScript - Learning Module</a></li>
</ul>
<p>If you are new to unit testing with Jest you can start with </p>
<ul>
<li><a href="https://jestjs.io/docs/getting-started">Jest getting started</a></li>
</ul>
<h2>Contributions</h2>
<p>Review review the general <a href="../../../CONTRIBUTING">Contribution Guidance</a>.</p>
<h2>Development Environment Setup</h2>
<p>You can edit and debug the cli using Visual Studio Code</p>
<ol>
<li>
<p>If you do not have Visual Studio Code you can visit visit <a href="https://code.visualstudio.com/Download">https://code.visualstudio.com/Download</a></p>
</li>
<li>
<p>Once installed Open the coe-cli folder in Visual Studio Code</p>
</li>
<li>
<p>The <a href=".....vscode%5Claunch.json">.vscode\launch.json</a> file contains a pre configured debug launch command</p>
</li>
<li>
<p>You can edit the <a href="....%5Csample.json">sample.json</a> file to the commands that you want to debug</p>
</li>
<li>
<p>Place breakpoints in the TypeScript files you want to debug and Press F5 to start debugging</p>
</li>
</ol>
<p>NOTES:</p>
<ul>
<li>
<p>Depending on the command you want to debug you mey be prompted to login in the DEBUG CONSOLE</p>
</li>
<li>
<p>If you are testing with a different account you will need to log out of any existing Azure CLI sessions</p>
</li>
</ul>
<pre><code class="language-bash">az logout

</code></pre>
<h3>Debugging Commands</h3>
<p>You can debug the coe-cli application commands using Visual Studio Code. </p>
<ol>
<li>Change the sample.json to the command or commands you want to run</li>
<li>Open the coe-cli folder in Visual Studio Code</li>
<li>Place breakpoints in the TypeScript code you want to debug</li>
<li>Press F5 or Select Run -&gt; Start Debugging</li>
</ol>
<p id="cli-development_documentation.md" class="next_file"></p>
<h1>Documentation</h1>
<p>Documentation is key to understanding how the cli works. As new commands are added consider the folowing</p>
<ul>
<li><a href="#add-markdown-pages">Add Markdown Pages</a> - Describe the functionality for end users</li>
<li><a href="#recording-command-line">Recording Command Line</a> to demonstrate process</li>
</ul>
<h2>Add Markdown Pages</h2>
<p>Add new pages to <a href="..%5Cdocs">docs</a> that describes the new command and how it is expected to be used.</p>
<p>Consider adding the following to the page</p>
<ol>
<li>Static images that summarize teh operation</li>
<li><a href="#recording-command-line">Recording Command Line</a> to demonstrate process</li>
</ol>
<h2>Recording Command Line</h2>
<p>To include a short animated recording of commands and the expected output you can use the following process</p>
<p>A. Install termtosvg in a unix terminal</p>
<pre><code class="language-bash">pip3 install --user termtosvg

</code></pre>
<p>This process will work cross platform and any of the following options could be used:</p>
<p>i) Native unix shell on MacOs or Linux distributions</p>
<p>ii) Docker images with a unix shell</p>
<p>iii) <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">Windows Subsystem for Linux</a> on Windows</p>
<p>B. Record the session to a cast file</p>
<pre><code class="language-bash">termtosvg record test.cast

</code></pre>
<p>The generated cast file is a simple text file that can be edited with any text editor.</p>
<p>C. Remove pauses using <a href="....%5Cscripts%5Cterm-trim.ps1">term-trim.ps1</a></p>
<pre><code class="language-bash">./term-trim.ps1 -Input test.cast -Output test2.cast -Trim 1

</code></pre>
<p>D. Generate the svg file</p>
<pre><code class="language-bash">termtosvg render test2.cast test.svg -t window_frame

</code></pre>
<p id="cli-development_adding-new-command.md" class="next_file"></p>
<h1>Adding a new Command</h1>
<p>To add a new sample command you can use the following command to template the initial setup of the TypeScript command and the jest unit test. </p>
<pre><code class="language-bash">cd coe-cli
coe cli add -n sample
</code></pre>
<h2>Connecting the command to the command line</h2>
<p>One you have unit test completed for your new command </p>
<ol>
<li>
<p>Review <a href="https://www.npmjs.com/package/commander">https://www.npmjs.com/package/commander</a> on commands, options</p>
</li>
<li>
<p>Update <a href=".%5Csrc%5Ccommands%5Ccommands.ts">commands.ts</a> to include a new command or sub command</p>
</li>
</ol>
<ul>
<li>Import your files at the top of the file</li>
</ul>
<pre><code class="language-typescript">import { SampleArguments, SampleCommand} from './sample';
</code></pre>
<ul>
<li>Add function for mock injection</li>
</ul>
<pre><code class="language-typescript">    createSampleCommand: () =&gt; SampleCommand
</code></pre>
<ul>
<li>Create command in the constructor function</li>
</ul>
<pre><code class="language-typescript">       this.createSampleCommand = () =&gt; new SampleCommand
</code></pre>
<ul>
<li>Add function</li>
</ul>
<pre><code class="language-typescript">    AddSampleCommand(program: commander.Command) {
        var run = program.command('sample')
            .description('A new sample command')
            .option('-c, --comment &lt;comment&gt;', 'The comment for the command')
            .action(async (options: any) : Promise&lt;void&gt; =&gt; {
                let args = new SampleArguments();
                args.comment = options.comment;
                let command = this.createSampleCommand();
                await command.execute(args)
            });
    }
</code></pre>
<ul>
<li>Register new command to init function </li>
</ul>
<pre><code class="language-typescript">        this.AddSampleCommand(program);
</code></pre>
<ol start="3">
<li>Update <a href=".%5Ctest%5Ccommands%5Ccommands.spec.ts">commands.spec.ts</a> to include unit tests</li>
</ol>
<ul>
<li>Include reference to the command</li>
</ul>
<pre><code class="language-typescript">import { SampleCommand } from '../../src/commands/sample'
</code></pre>
<ul>
<li>Add a set of Jest tests</li>
</ul>
<pre><code class="language-typescript">describe('Sample', () =&gt; {
    test('Execute', async () =&gt; {
        // Arrange
        var commands = new CoeCliCommands();
        let mockSampleCommand = mock&lt;SampleCommand&gt;(); 

        commands.createSampleCommand = () =&gt; mockSampleCommand
        mockSampleCommand.execute.mockResolvedValue()
        
        // Act
        await commands.execute(['node', 'commands.spec', 'sample', '-c', 'Some comment'])

        // Assert
        expect(mockSampleCommand.execute).toHaveBeenCalled()
    })
});
</code></pre>
<ol start="4">
<li>Run the unit tests with new changes</li>
</ol>
<pre><code class="language-bash">npm run test

```&lt;p id=&quot;install.md&quot; class=&quot;next_file&quot;&gt;&lt;/p&gt;

# Installation

To install the COE CLI

1. Download zip or clone repository

2. Change to unzipped or cloned repository

3. cd coe-cli

```bash
cd coe-cli

</code></pre>
<p>Next select either <a href="#local-install">Local Install</a> or <a href="#docker-install">Docker Install</a></p>
<h2>Local Install</h2>
<h3>Prerequisites</h3>
<p>To run the COE CLI application you will require the following</p>
<ol>
<li>An installation of Node 11+ for versions (12, 14, 16)
a) https://nodejs.org/en/download/</li>
<li>Azure CLI is required for user authentication and Azure Active Directory Integration
a) https://docs.microsoft.com/en-us/cli/azure/install-azure-cli</li>
</ol>
<h3>Checking Prerequisites</h3>
<p>To check prerequisites installed at the command prompt</p>
<ol>
<li>Verify node version</li>
</ol>
<pre><code class="language-bash">node --version

</code></pre>
<ol start="2">
<li>Verify Azure CLI Version</li>
</ol>
<pre><code class="language-bash">az --version

</code></pre>
<h3>Install</h3>
<ol>
<li>Install application dependencies</li>
</ol>
<pre><code class="language-bash">npm install

</code></pre>
<ol start="2">
<li>Build the application</li>
</ol>
<pre><code class="language-bash">npm run build

</code></pre>
<ol start="3">
<li>Link to the CLI application</li>
</ol>
<pre><code class="language-bash">npm link

</code></pre>
<p>NOTE:</p>
<ol>
<li>
<p>On Windows you may need to add %APPDATA%\npm to your PATH environment variable to access the coe command</p>
</li>
<li>
<p>Install Azure CLI. Follow install instructions for you operating system at https://docs.microsoft.com/en-us/cli/azure/install-azure-cli</p>
</li>
</ol>
<h2>Docker Install</h2>
<p>One method of installation is via docker.</p>
<h3>Prerequisites</h3>
<p>To run the COE CLI application you will require the following</p>
<ol>
<li>A local install of <a href="https://docs.docker.com/get-docker/">Docker</a></li>
</ol>
<h3>Install</h3>
<p>NOTE: Note on some operating systems you may need to use sudo before each of the docker commands.</p>
<ol>
<li>Build docker image. </li>
</ol>
<pre><code class="language-bash">cd coe-cli
docker build -t coe-cli . 
</code></pre>
<ol start="2">
<li>Using the docker image</li>
</ol>
<pre><code class="language-bash">docker run -it --rm coe-cli
</code></pre>
<p>This will start a new interactive console (-it) and remove the docker container (--rm) when the console session exits. Using --rm ensures that any cached credentials are removed when you exit.</p>
<script src='prism.js'></script>
</body></html>
